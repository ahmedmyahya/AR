<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - <%= user.username %></title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body class="<%= user && user.theme === 'dark' ? 'dark' : '' %>">
    <%- include('partials/header') %>

    <main class="container">
      <h1>Welcome, <%= user.username %>!</h1>
      <p>Manage your 3D models here.</p>

      <div class="button-group mb-20">
        <a href="/upload" class="button">Upload New Model</a>
        <button class="button theme-toggle-btn" onclick="toggleTheme()">
          <% if (user && user.theme === 'dark') { %> ‚òÄÔ∏è <% } else { %> üåô <% }
          %>
        </button>
      </div>

      <% if (error) { %>
      <div class="error-message"><%= error %></div>
      <% } %>

      <h2>Your Uploaded Models (<%= totalModels %> total)</h2>
      <% if (models.length > 0) { %>
      <div class="model-table-container">
        <table class="model-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Filename</th>
              <th>Tags</th>
              <th>Live</th>
              <th>Uploaded On</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% models.forEach(model => { %>
            <tr>
              <td><%= model.name %></td>
              <td><%= model.filename %></td>
              <td><%= model.tags.join(', ') %></td>
              <td><%= model.isLive ? 'Yes' : 'No' %></td>
              <td><%= new Date(model.createdAt).toLocaleDateString() %></td>
              <td class="actions">
                <a
                  href="/viewer?model=<%= model.username %>/<%= model.filename %>"
                  target="_blank"
                  class="button secondary"
                  >View</a
                >
                <a href="/edit-model/<%= model.id %>" class="button edit"
                  >Edit</a
                >
                <form
                  action="/delete-model/<%= model.id %>"
                  method="POST"
                  style="display: inline"
                  onsubmit="return confirm('Are you sure you want to delete <%= model.name %>? This cannot be undone!');"
                >
                  <button type="submit" class="button delete">Delete</button>
                </form>
              </td>
            </tr>
            <% }); %>
          </tbody>
        </table>
      </div>

      <div class="pagination-controls">
        <% if (currentPage > 1) { %>
        <a
          href="/dashboard?page=<%= currentPage - 1 %>&limit=<%= limit %>"
          class="pagination-button"
          >Previous</a
        >
        <% } %> <% for (let i = 1; i <= totalPages; i++) { %>
        <a
          href="/dashboard?page=<%= i %>&limit=<%= limit %>"
          class="pagination-button <%= i === currentPage ? 'active' : '' %>"
          ><%= i %></a
        >
        <% } %> <% if (currentPage < totalPages) { %>
        <a
          href="/dashboard?page=<%= currentPage + 1 %>&limit=<%= limit %>"
          class="pagination-button"
          >Next</a
        >
        <% } %>
      </div>

      <% } else { %>
      <p class="text-center">
        You haven't uploaded any models yet. Time to get started!
      </p>
      <% } %>
    </main>

    <%- include('partials/footer') %>

    <script src="/js/theme-toggle.js"></script>
  </body>
</html>
